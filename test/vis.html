
<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>vis test</title>

  <style>
    body, html {
      font-family: arial, sans-serif;
      font-size: 9pt;
    }

    #title {
      font-weight: bold;
      text-align: center;
    }

    #visualization {
      box-sizing: border-box;
      width: 100%;
      height: 300px;
    }

    .vis-item {
      padding: 10px 5px;
      text-align: center;
    }

    .vis-item.path-t {
      background-color: rgba(255, 0, 0, 0.9);
    }

    .vis-item.path-nt {
      background-color: rgba(255, 165, 0, 0.9);
    }
  </style>

  <script src="vis-timeline-graph2d.min.js"></script>
  <link href="vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
  
</head>
<body>
  <p id="title">Suivi longitudinal de Monsieur ___ ____</p>
  <div id="visualization"></div>

  <script>
    var groups = new vis.DataSet([
      {id: 0, content: 'Pathologies', value: 1},
      {id: 1, content: 'Examens et consultations', value: 3},
      {id: 2, content: 'Traitements', value: 2}
    ]);

    // create a dataset with items
    // note that months are zero-based in the JavaScript Date object, so month 3 is April
    var items = new vis.DataSet([
      {id: 0, group: 0, className: 'path-t', content: 'Path. T', title: 'Pathologie T', start: new Date(2014, 3, 17)},
      {id: 1, group: 0, className: 'path-nt', content: 'Path. NT', title: 'Pathologie NT',  start: new Date(2014, 5, 17)},
      {id: 2, group: 1, content: '<p>a=1 b=2</p><p><span style="color:red">c=5</span> d=4</p>', start: new Date(2014, 4, 17)},
      {id: 3, group: 1, content: 'Examen 2', start: new Date(2014, 5, 17)},
      {id: 4, group: 1, content: 'Examen 3', start: new Date(2014, 7, 17)},
      {id: 5, group: 1, content: 'Examen 4', start: new Date(2015, 10, 10)},
      {id: 6, group: 2, className: 'path-t', content: 'Traitement T', title: 'Traitement T',  start: new Date(2014, 4, 17)},
      {id: 7, group: 2, className: 'path-nt', content: 'Traitement NT', title: 'Traitement NT',  start: new Date(2014, 6, 17)}
    ]);

    // create visualization
    var container = document.getElementById('visualization');

    // calculate end date (now + 6 months)
    var now = new Date();
    var initEnd = now.getTime() + 6 * 1000*60*60*24*30.42; 

    var options = {
      // option groupOrder can be a property name or a sort function
      // the sort function must compare two groups and return a value
      //     > 0 when a > b
      //     < 0 when a < b
      //       0 when a == b
      groupOrder: function (a, b) {
        return a.value - b.value;
      },
      editable: false,
      multiselect: false,
      hiddenDates: [/*{start: '2014-08-23 00:00:00', end: '2015-11-01 00:00:00'}*/
                    ],
      end: initEnd
    };

    var timeline = new vis.Timeline(container);
    timeline.setOptions(options);
    timeline.setGroups(groups);
    timeline.setItems(items);

    function hideEmptySpaceUntilNow (tolerance) {
      // find oldest item's date
      // convoluted, use forEach() instead ?
      let oldestDate = new Date(1970, 0, 1);
      let oldItems = items.get({
        filter: function (item) {
          if(item.start.getTime() > oldestDate.getTime()){
            oldestDate = item.start;
            return 1;
          }return 0;
        }
      });
      /*let oldestItem = oldItems[oldItems.length];*/
      
     /* alert('Oldest date found : ' + oldestDate.toString());*/

      oldestDate.setTime(oldestDate.getTime() + 1000 * 60 * 60 * 24 * tolerance);
      options.hiddenDates.push({start: oldestDate, end: new Date()});
    }

    // TODO: hide all dates that are more than TOLERANCE days away from any item
    function hideAllEmptySpace (tolerance) {
      // For each item except for first and last items :  
        // if is not first or last item hideEmptySpaceAroundItem(item, tolerance)

      hideEmptySpaceUntilNow(tolerance);
    }

    function hideEmptySpaceAroundItem (item, tolerance) {
      let msTolerance = 1000 * 60 * 60 * 24 * tolerance;
      
      // find lower and upper limit (start -/+ tolerance)
      let limitLow = lowerLimit(item, msTolerance);
      let limitHigh = upperLimit(item, msTolerance);

      // find closest upper limit from items that started before

      // find closest lower limit from items that started before
      
      // delete range between those limits if necessary
    }

    function lowerLimit(item, msTolerance) {
      return item.start.getTime() - msTolerance;
    }

    function upperLimit(time, msTolerance) {
      return item.start.getTime() + msTolerance;
    }

    hideAllEmptySpace(31);
    
  </script>
</body>
</html>